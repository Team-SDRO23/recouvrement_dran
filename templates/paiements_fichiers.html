{% extends "base.html" %} {# ou votre layout si différent #}
{% block content %}
<div class="container mt-4">
    <form method="post" action="{{ url_for('paiements_fichiers') }}" onsubmit="return confirm('Confirmez-vous la suppression des fichiers sélectionnés ?');">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Fichiers de paiements ({{ files|length }})</h3>
            <button type="submit" class="btn btn-danger" id="delete-selected" disabled>
                Supprimer les fichiers sélectionnés
            </button>
        </div>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="mt-3">
            {% for msg in messages %}
            <div class="alert alert-info py-2 my-1">{{ msg|safe }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if files %}
        <div class="table-responsive mt-3">
            <table class="table table-sm table-striped align-middle">
                <thead>
                    <tr>
                        <th style="width: 1%;">
                            <input type="checkbox" id="select-all" title="Tout sélectionner / désélectionner">
                        </th>
                        <th>Nom du fichier</th>
                        <th>Taille</th>
                        <th>Modifié le</th>
                    </tr>
                </thead>
                <tbody>
                    {% for f in files %}
                    <tr>
                        <td>
                            <input type="checkbox" name="filenames" value="{{ f.name }}">
                        </td>
                        <td>{{ f.name }}</td>
                        <td>{{ f.size }}</td>
                        <td>{{ f.mtime }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted mt-3">Aucun fichier trouvé dans le dossier des paiements.</p>
        {% endif %}
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const selectAllCheckbox = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('input[name="filenames"]');
        const deleteButton = document.getElementById('delete-selected');

        function updateButtonState() {
            const hasChecked = Array.from(checkboxes).some(cb => cb.checked);
            deleteButton.disabled = !hasChecked;
        }

        selectAllCheckbox.addEventListener('change', function() {
            checkboxes.forEach(cb => {
                cb.checked = selectAllCheckbox.checked;
            });
            updateButtonState();
        });

        checkboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                if (!this.checked) {
                    selectAllCheckbox.checked = false;
                }
                updateButtonState();
            });
        });

        updateButtonState(); // Initial check
    });
</script>
{% endblock %}